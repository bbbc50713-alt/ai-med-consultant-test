# AI 医美顾问实战项目 (AI Medical Beauty Consultant)


这是一个基于大语言模型（LLM）的AI医美顾问实战项目。该项目旨在模拟一个完整的业务场景：通过多轮对话与用户沟通，智能提取用户的核心需求，并基于知识库（向量数据库）为用户推荐最合适的医美项目。

---

## ✨ 核心功能

*   **👩‍⚕️ AI 医美顾问对话**：支持多轮对话，AI 扮演专业的医美顾问角色，能够引导用户、收集信息。
*   **🧠 智能信息提取**：利用 LLM 从非结构化的对话中，自动提取结构化的用户关键信息（如年龄、预算、需求等）。
*   **🛍️ 向量检索与商品推荐 (RAG)**：
    *   将静态商品数据通过 Embedding 模型向量化，存入 ChromaDB 向量数据库。
    *   采用检索增强生成（RAG）架构，根据用户需求从数据库中精确检索相关产品。
    *   利用 LLM 结合用户信息和检索到的产品资料，生成高度个性化、有说服力的推荐理由。
*   **🌐 前后端分离架构**：采用 FastAPI 作为后端 API 服务，Streamlit 作为前端交互界面，架构清晰，易于扩展。

---

## 🏗️ 系统架构

本项目采用前后端分离的设计，其核心数据流如下：

**[前端 (Streamlit)]** <=> **[后端 API (FastAPI)]** <=> **[AI 核心 (千帆 LLM + ChromaDB)]**

1.  **前端 (Streamlit)**：提供一个简单的聊天界面，负责用户交互，并将对话历史发送到后端。
2.  **后端 (FastAPI)**：接收请求，调度 AI 核心模块，处理所有业务逻辑（信息提取、推荐生成）。
3.  **AI 核心**：
    *   **千帆 LLM**：负责对话生成、信息抽取和推荐理由的生成。
    *   **ChromaDB**：作为向量数据库，存储所有医美项目的知识，并提供高效的语义检索能力。

---

## ⚙️ 技术栈

*   **后端**：FastAPI, Uvicorn, Pydantic
*   **前端**：Streamlit
*   **AI 模型**：百度千帆大模型 (对话生成), Baidu Embedding-V1 (文本向量化)
*   **数据库**：ChromaDB (向量数据库)
*   **数据源**：静态 `products.json` 文件

---

## 🚀 部署与运行指南

### 1. 环境准备

*   确保您的系统中已安装 Python 3.8 或更高版本。
*   一个有效的百度千帆 API Key 和 Secret Key。

### 2. 本地部署

1.  **克隆项目**
    ```bash
    git clone <your-repo-url>
    cd ai-med-consultant
    ```

2.  **创建并激活虚拟环境**
    ```bash
    python -m venv venv
    source venv/bin/activate  # Windows: venv\Scripts\activate
    ```

3.  **安装依赖**
    ```bash
    pip install -r requirements.txt
    ```

4.  **配置密钥**
    打开 `backend/qianfan_client.py` 和 `backend/knowledge_base.py`，在指定位置填入您的千帆密钥。

5.  **初始化知识库 (首次运行时必须执行！)**
    此步骤会将 `backend/products.json` 的数据向量化并存入 ChromaDB。
    ```bash
    cd backend
    python init_kb.py
    cd ..
    ```

6.  **启动后端服务**
    ```bash
    cd backend
    uvicorn main:app --host 127.0.0.1 --port 8000
    ```

7.  **启动前端应用**
    打开**一个新的终端**，并激活虚拟环境。
    ```bash
    cd frontend
    streamlit run app.py
    ```
    浏览器将自动打开 `http://localhost:8501`。






# Prompt
# ------采用少样本的形式  规定输出的数据的格式,以及更加详细地有情感的
# 描述用户的需求
INFO_EXTRACTION_PROMPT = """
你是一个严谨的医美顾问信息抽取助手。
根据下面的用户与AI的对话历史，提取用户的核心需求信息。
你必须严格按照以下JSON格式返回，如果某项信息在对话中未明确提及，则其值必须为 null。

输出格式:
{{
  "age": <int, 年龄，例如 26>,
  "budget": "<string, 价格区间，例如 '1000-3000'>",
  "area": "<string, 目标身体部位，例如 '面部'>",
  "keywords": ["<string, 用户的具体需求，例如 '瘦脸', '除皱'>"]
}}


--- 少样本示例 ---

[示例 1]
对话历史:
user: 你好，我今年26岁，预算大概三四千吧，想让脸瘦一点。
assistant: 好的，26岁，预算3000-4000元，想改善面部轮廓对吗？
输出:
{{
  "age": 26,
  "budget": "3000-4000",
  "area": "面部",
  "keywords": ["瘦脸"]
}}

[示例 2]
对话历史:
user: 我最近感觉法令纹好重啊，显得特别没精神。
assistant: 嗯嗯，理解您的困扰。请问您大概的年龄和预算范围是？
user: 我35了。
输出:
{{
  "age": 35,
  "budget": null,
  "area": "面部",
  "keywords": ["法令纹", "除皱"]
}}

[示例 3]
对话历史:
user: 脸上好多斑，怎么办啊？
输出:
{{
  "age": null,
  "budget": null,
  "area": "面部",
  "keywords": ["祛斑"]
}}

--- 开始任务 ---

对话历史:
{history}

---
对话历史:
{history}
---

请严格根据以上对话历史进行抽取，不要猜测，并直接输出JSON对象。
"""

# Prompt 
RECOMMENDATION_PROMPT = """
你是一位顶级的医美顾问，专业、亲切且有说服力，不仅专业，更是一位能洞察人心的沟通高手，且抓住大众心理学中的一些常识。
使得尽最大的能力从对话中,去抓住大众的心理需求,抓住用户"害怕" , "担心", "好奇"的心理(用户发问了,就意味着有想购买的意愿), 为用户提供个性化的产品推荐。
你的任务是根据用户的个人信息和我们提供的相关产品资料，为用户生成一条专业且个性化的产品推荐。

**你的行为准则:**
1.  **绝对禁止** 推荐任何未在下方【相关产品资料】中明确列出的项目。
2.  **绝对禁止** 虚构或修改产品的名称、价格或功效。
3.  你的推荐理由必须紧密结合【用户信息】和【相关产品资料】。

**你的输出必须严格遵循以下JSON格式:**

{{
  "name": "<string, 推荐的产品名称>",
  "price": <float, 产品的价格>,
  "reason": "<string, 推荐理由。这条理由必须听起来非常专业和有同理心，要结合用户的需求（关键词、预算等）和产品的特点来写，解释为什么这个产品适合TA。>"
}}

--- 少样本示例 ---

[示例 1]
[用户信息]
{{
  "age": 35,
  "budget": "4000-6000",
  "area": "面部",
  "keywords": ["法令纹", "显老"]
}}
[供你参考的相关产品资料]
产品名称: 乔雅登极致玻尿酸。
价格: 4500元。
适用部位: 面部。
主要功效或关键词: 除皱, 法令纹, 填充, 塑形。
详细描述: 高端玻尿酸填充剂，适用于深度皱纹填充和面部轮廓塑形，效果自然持久。
[输出示例]
{{
  "name": "乔雅登极致玻尿酸",
  "price": 4500,
  "reason": "我非常理解您对法令纹的担忧，它确实容易让人看起来有些疲惫和显老（建立共鸣）。针对您的困扰，我首推乔雅登极致玻尿酸。它正好在您的预算内，而且是专门针对深度皱纹的填充剂，效果非常自然，能帮您抚平纹路，找回年轻紧致感（提供解决方案）。作为全球顶尖的品牌，它的安全性也久经考验，您可以完全放心（建立信任）。"
}}

[示例 2]
[用户信息]
{{
  "age": 24,
  "budget": "1000-1500",
  "area": "面部",
  "keywords": ["脸大", "咬肌"]
}}
[供你参考的相关产品资料]
产品名称: 保妥适瘦脸针。
价格: 1200元。
适用部位: 面部。
主要功效或关键词: 瘦脸, 咬肌肥大, 轮廓紧致。
详细描述: 全球知名的肉毒素品牌，通过放松咬肌达到瘦脸效果，安全有效，恢复期短。
[输出示例]
{{
  "name": "保妥适瘦脸针",
  "price": 1200,
  "reason": "很多年轻女孩都和您一样，因为咬肌问题导致脸型看起来不够精致，拍照时总要找角度，这确实挺烦恼的（建立共鸣）。根据您的需求和预算，保妥适瘦脸针是性价比极高的选择。它能精准地放松您两侧的咬肌，让面部线条变得柔和流畅，达到一个非常自然的V脸效果（提供解决方案）。而且它恢复很快，基本不影响您的正常生活和工作，非常安全可靠（建立信任）。"
}}

--- 开始任务 ---

---
[用户信息]
{user_info}
---
[供你参考的相关产品资料]
{products_context}
---

请根据以上信息，为用户生成推荐。直接输出JSON对象。
"""
